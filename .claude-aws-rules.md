# Claude Code AWS 運用ルール

**このファイルはClaudeがAWS操作前に必ず確認すること**

参照元: `/Users/sasakiryo/Documents/bewibe-infra/docs/operations.md`

---

## AWSプロファイル

| プロファイル | 用途 | 権限 |
|-------------|------|------|
| `claude-code` | Claude用 | `claude-*` リソースのみ、作成/削除不可 |
| `tuun-terraform` | 人間用 | フルアクセス |

**Claudeは常に `AWS_PROFILE=claude-code` を使用**

---

## できること

- `claude-*` プレフィックスのリソースのみ操作可能
  - Lambda コード更新（UpdateFunctionCode）
  - DynamoDB データ操作（CRUD）
  - S3 オブジェクト操作
- `terraform plan` 実行
- Terraform定義の新規 resource 追加（ファイル作成のみ）
- apply手順書の作成

---

## 絶対にやってはいけないこと

| 禁止操作 | 理由 |
|---------|------|
| `terraform apply` | 人間が実行する |
| `terraform destroy` | 人間が実行する |
| 既存TUUNリソースへの書き込み | `tuun-*`, `Users`, `blood-results` 等はIAMで拒否 |
| Lambda / DynamoDB / S3 の新規作成（AWS CLI直接） | Terraform経由に統一 |
| リソース削除 | 取り消し困難 |
| IAM変更 | セキュリティリスク |
| 既存 Terraform resource ブロックの編集 | 意図しない変更防止 |

---

## 命名規則

Claudeが新規作成するリソースは必ず `claude-` プレフィックスを付ける：

| リソース | 命名例 |
|---------|--------|
| Lambda | `claude-test-function` |
| DynamoDB | `claude-dev-data` |
| S3バケット | `claude-sandbox-295250016740` |
| IAMロール | `claude-lambda-role` |

---

## Terraform変更時のルール

1. **既存 resource ブロックには手を入れない**
2. **新しいものは必ず新規 resource 追加で対応**
3. **terraform plan に既存リソースの変更が出たら**：
   - 差分がゼロになるまでコードを修正
   - 既存リソースへの変更が必要な場合は RYO に確認

---

## 作業フロー

```
新機能が必要
    ↓
Terraform定義を新規 resource として追加
    ↓
terraform plan で確認（Claude実行OK）
    ↓
RYOに報告「planの結果こうなりました。applyお願いします」
    ↓
RYOが terraform apply 実行
    ↓
Claudeは作成されたリソースを使って開発継続
```

---

## FUUD関連のAWSリソース

| リソース | 名前 | 用途 |
|---------|------|------|
| API Gateway | `fuud-api-dev` | FUUD API エンドポイント |
| Lambda | `calculate_tdee` | TDEE計算 |
| Lambda | `search_foods` | 食品検索 |
| Lambda | `log_weight` | 体重記録 |
| Lambda | `log_meal` | 食事記録 |

Base URL: `https://5l5ol9ehia.execute-api.ap-northeast-1.amazonaws.com`

---

## 重要な注意事項

1. **AWS操作前に必ずこのファイルを確認する**
2. **迷ったらRYOに確認する**
3. **destroyは絶対に実行しない**
4. **既存リソースを壊さない**
