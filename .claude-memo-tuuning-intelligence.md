# TUUNING Intelligence 実装メモ

**作成日**: 2025-12-01
**目的**: 会話を新しくしても引き継げる注意事項のメモ

---

## 重要な注意事項

### 1. Lambda ZIPファイルのバージョン管理

- **命名規則**: `tuuning_intelligence_v{番号}.zip`
  - 例: `tuuning_intelligence_v1.zip` → `tuuning_intelligence_v2.zip`

- **更新手順**:
  1. 前バージョンのZIPを必ずコピー
  2. 修正箇所のみを更新
  3. 新しいバージョン番号でZIP化
  4. 古いバージョンは削除しない（ロールバック用）

```bash
# バージョンアップ手順
cp tuuning_intelligence_v1.zip tuuning_intelligence_v2.zip
unzip tuuning_intelligence_v2.zip -d temp_v2
# lambda_function.py を修正
cd temp_v2
zip -r ../tuuning_intelligence_v2.zip .
```

### 2. バックエンドデプロイは手動

- MCPに読み取り権限しかないため、ZIPファイルはユーザーが手動でAWSにアップロード
- Claudeがやること:
  - lambda_function.py のコード作成
  - ZIPファイル作成手順の説明
  - デプロイ手順の説明
- ユーザーがやること:
  - AWS Consoleからアップロード

### 3. 実装フェーズ

```
Phase 1: フロントエンド実装
├── Step 1-1: モデル定義 (AIInsightModels.swift)
├── Step 1-2: Service作成 (TuuningIntelligenceService.swift)
├── Step 1-3: ConfigurationManager更新
├── Step 1-4: AITimeBasedInsightSection更新
└── Step 1-5: デバッグビュー追加 (DataCollectionDebugView.swift)

Phase 2: 実機確認 ← フロントエンド完了後に実施
├── データ取得確認
├── JSON形式確認
└── 問題修正

Phase 3: バックエンド実装 ← 実機確認後に実施
├── Step 3-1: Lambda関数作成 (tuuning_intelligence_v1.zip)
├── Step 3-2: API Gateway設定
└── Step 3-3: フロントエンド接続
```

### 4. 使用データ（25項目）

**血液（10項目）**: HbA1c, FPG, TG, HDL, LDL, CRP, Ferritin, AST, UA, INS

**HealthKit（10項目）**: HRV, RHR, VO2Max, 睡眠時間, 深い睡眠, REM, 歩数, アクティブカロリー, 直近ワークアウト, 体重

**遺伝子（5項目）**: カフェイン代謝, 概日リズム, 高脂肪ダイエット効果, 高たんぱくダイエット効果, 眠りの深さ

### 5. デバッグビューについて

- データ収集が正しく動作しているか確認するためのUI
- 本番では非表示または設定画面からアクセス可能にする
- JSON形式でAPI送信データをプレビュー可能

---

## 関連ファイル

- 実装計画: `/Users/sasakiryo/.claude/plans/linked-finding-papert.md`
- プロジェクト: `/Users/sasakiryo/Documents/TestFlight`
- Lambda保存先: `/Users/sasakiryo/Documents/TestFlight/lambda_deployment/`

---

## AWS情報

- プロファイル: `tuun`
- リージョン: `ap-northeast-1`
- 既存Chat API: `https://kbodeqy5wa.execute-api.ap-northeast-1.amazonaws.com/prod/chat`
- 新規Lambda関数名: `tuuning-intelligence-api`
- 新規エンドポイント: `/prod/intelligence`
